launch:
    parameters: 
         appPrefix:
             description: Web application prefix
             default: myApp
         accessKey:
             description: AWS Access Key
         secretKey:
             description: AWS Secret Key

    steps:
        - provision:
            action: provisionAmazonVm
            parameters:
                 roleName: web
                 jcloudsIdentity: $accessKey
                 jcloudsCredential: $secretKey
                 ec2SecurityGroup: wlc
            output:
                 publicIp: ips
        - download:
            action: gitClone
            description: Clone instalation scripts to install WLP
            parameters:
                roles: [web]
                phase: download
                precedingPhases: [provision]
                url: https://github.com/erkfel/wlp.git
                targetDirectory: wlp
        - install:
            action: execrun
            description: Execute instalation of WLP
            parameters:
                phase: run
                precedingPhases: [download]
                roles: [web]
                command:
                     - ~/wlp/install.sh
    return:
        - appUrl:
            description: Url to the application
            value: http://${publicIp}:9080

destroy:
  steps:
    - undeployEnv:
        action: "undeployEnv"
        parameters:
          phase: "destroy"